# Set UTF-8 as standard charset
AddDefaultCharset UTF-8

# Map .woff2 files to mime type font/woff2
AddType font/woff2 .woff2

# Limit request body to 10MB
LimitRequestBody 10240000

# Server response header
#ServerTokens Prod
ServerTokens OS

# Server version on server generated pages
ServerSignature Off

# Allow TRACE method
TraceEnable Off

# Enable error pages
ErrorDocument 400 /error/index.php?errorCode=400%20-%20Bad%20Request
ErrorDocument 401 /error/index.php?errorCode=401%20-%20Unauthorized
ErrorDocument 403 /error/index.php?errorCode=403%20-%20Forbidden
ErrorDocument 404 /error/index.php?errorCode=404%20-%20Not%20Found
ErrorDocument 500 /error/index.php?errorCode=500%20-%20Internal%20Server%20Error

<Directory />
    # Deny access
    Order Deny,Allow
    Deny from all
</Directory>

<Directory /var/www/>
    # Allow access
    Order Allow,Deny
    Allow from all
    # Disable directory browsing and .htaccess files
    Options -Indexes
    AllowOverride None
    # Reset default file and set it to php first, html second
    DirectoryIndex disabled
    DirectoryIndex index.php index.html
</Directory>

# Enable caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType font/woff2 "access plus 2 days"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/html "access plus 1 month"
    ExpiresByType text/javascript "access plus 2 days"
    ExpiresByType text/x-javascript "access plus 1 month"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/atom_xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/x-shockwave-flash
</IfModule>

# Enable redirection to HTTPS
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteCond %{SERVER_PORT} 80
    RewriteCond %{HTTP_HOST} ^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$  [NC]
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301]
    RewriteCond %{HTTP_HOST} ^www\.(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*)$  [NC]
    RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [L,R=301]
</IfModule>

<IfModule mod_headers.c>
    # Keep content type header and do not interpret filetype
    Header set X-Content-Type-Options: "nosniff"

    # Defend against clickjacking attacks by preventing other sites from embedding pages from this site as frames
    Header set X-Frame-Options: "sameorigin"

    Header set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security " \
        max-age=15768000; \
        includeSubDomains; \
        preload" \
        env=HTTPS
    Header set Access-Control-Allow-Origin "https://randomwinpicker.de/, https://randomwinpicker.test/"
    Header set Content-Security-Policy " \
        connect-src 'self'; \
        default-src 'none'; \
        font-src 'self' https://fonts.gstatic.com/; \
        frame-src 'self' https://www.google.com/recaptcha/; \
        img-src 'self' https://csgostash.com/img/skins/ http://www.google-analytics.com/; \
        script-src 'self' https://www.google.com/recaptcha/ http://www.google-analytics.com/ https://www.googletagmanager.com/ https://www.gstatic.com/recaptcha/ https://code.jquery.com/; \
        style-src 'self' 'sha256-MammJ3J+TGIHdHxYsGLjD6DzRU0ZmxXKZ2DvTePAF0o=' 'sha256-6iA6WDOL1mgUULZ6GSs2OOfP4eMuu6iI5agxCjK2m2A=' 'sha256-+zzuded9+DHoztKyASJeCkVU0gxvYNWMUIQM7x//CB4=' 'sha256-ldCXMle1JJUAD9eAjLdSuPIgIBcTcBecWlaXs0A2y4M=' 'sha256-WCg1a4AhMGgFRCQG5w+hgG+Q2j8Ygrbd+2dgjByIOIU=' 'sha256-Awu6hl63MCY3jiYHaDclrL7Lic9KcEalXm2o/i3e0v8=' https://fonts.googleapis.com/ \
        worker-src 'self';"
    Header append Vary: Accept-Encoding
    Header set Referrer-Policy strict-origin-when-cross-origin
    Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure
</IfModule>
