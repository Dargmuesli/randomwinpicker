{
    "Owner": "dargmuesli",
    "RegistryAddress": {
        "Name": "registry",
        "Hostname": "localhost",
        "Port": "5000"
    },
    "ComposeFile": {
        "Name": "docker-compose.yml",
        "Content": {
            "version": "3.6",
            "services": {
                "adminer": {
                    "image": "adminer",
                    "labels": [
                        "traefik.backend=adminer",
                        "traefik.frontend.rule=Host:adminer.randomwinpicker.test"
                    ]
                },
                "apache": {
                    "image": "localhost:5000/dargmuesli/randomwinpicker.de",
                    "deploy": {
                        "replicas": 1,
                        "restart_policy": {
                            "condition": "on-failure"
                        }
                    },
                    "volumes": [
                        "./dist/randomwinpicker.de:/var/www/randomwinpicker.de"
                    ],
                    "labels": [
                        "traefik.backend=apache",
                        "traefik.frontend.rule=Host:randomwinpicker.test,www.randomwinpicker.test",
                        "traefik.protocol=https",
                        "traefik.port=443"
                    ]
                },
                "postgres": {
                    "image": "postgres",
                    "environment": {
                        "POSTGRES_USER_FILE": "/run/secrets/postgres_user",
                        "POSTGRES_PASSWORD_FILE": "/run/secrets/postgres_password",
                        "POSTGRES_DB_FILE": "/run/secrets/postgres_db"
                    },
                    "secrets": [
                        "postgres_user",
                        "postgres_password",
                        "postgres_db"
                    ],
                    "volumes": [
                        "postgres-data:/var/lib/postgresql/data"
                    ],
                    "labels": [
                        "traefik.backend=postgres",
                        "traefik.frontend.rule=Host:postgres.randomwinpicker.test"
                    ]
                },
                "traefik": {
                    "image": "traefik",
                    "ports": [
                        "80:80",
                        "443:443"
                    ],
                    "deploy": {
                        "mode": "global",
                        "placement": {
                            "constraints": [
                                "node.role == manager"
                            ]
                        }
                    },
                    "volumes": [
                        "/var/run/docker.sock:/var/run/docker.sock",
                        "./docker/conf/certs:/etc/ssl/certs"
                    ],
                    "command": [
                        "--entryPoints=Name:http Address::80 Redirect.EntryPoint:https",
                        "--entryPoints=Name:https Address::443 TLS:/etc/ssl/certs/server.cer,/etc/ssl/certs/server.key Compress:true",
                        "--defaultentrypoints=http,https",
                        "--insecureSkipVerify=true",
                        "--api",
                        "--docker"
                    ],
                    "labels": [
                        "traefik.port=8080",
                        "traefik.backend=traefik",
                        "traefik.frontend.rule=Host:traefik.randomwinpicker.test",
                        "traefik.docker.network=randomwinpicker-de_default"
                    ]
                }
            },
            "secrets": {
                "postgres_user": {
                    "external": true
                },
                "postgres_password": {
                    "external": true
                },
                "postgres_db": {
                    "external": true
                }
            },
            "volumes": {
                "postgres-data": {}
            }
        }
    }
}
